<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDxHZYFDLX6xDaMgEvHq9NMiIp9RbsmbrM" type="text/javascript"></script>
<script src="/public/javascripts/jquery.distancecalculator.js"></script>

<script type="text/javascript">
$(function(){

  $('.fx-select-expense-type').on('change', function(e){
    e.preventDefault();

    var costState = $(this).find(':selected').attr('data-cost');
    var dateState = $(this).find(':selected').attr('data-date');
    var destinationState = $(this).find(':selected').attr('data-destination');
    var distanceState = $(this).find(':selected').attr('data-distance');
    var hoursState = $(this).find(':selected').attr('data-hours');
    var locationState = $(this).find(':selected').attr('data-location');
    var mileageState = $(this).find(':selected').attr('data-mileage');
    var reasonState = $(this).find(':selected').attr('data-reason');
    var netAmountState = $(this).find(':selected').attr('data-net-amount');
    var vatAmountState = $(this).find(':selected').attr('data-vat-amount');


    $('.fx-travel-cost').is(function(){
      var $el = $(this);
      costState == "true" ? $el.show() : $el.hide();
    });

    $('.fx-travel-date').is(function(){
      var $el = $(this);
      dateState == "true" ? $el.show() : $el.hide();
    });

    $('.fx-travel-destination').is(function(){
      var $el = $(this);
      destinationState == "true" ? $el.show() : $el.hide();
    });

    $('.fx-travel-distance').is(function(){
      var $el = $(this);
      distanceState == "true" ? $el.show() : $el.hide();
    });

    $('.fx-travel-hours').is(function(){
      var $el = $(this);
      hoursState == "true" ? $el.show() : $el.hide();
    });

    $('.fx-travel-location').is(function(){
      var $el = $(this);
      locationState == "true" ? $el.show() : $el.hide();
    });

    $('.fx-travel-mileage').is(function(){
      var $el = $(this);
      mileageState == "true" ? $el.show() : $el.hide();
    });

    $('.fx-travel-reason').is(function(){
      var $el = $(this);
      reasonState == "true" ? $el.show() : $el.hide();
    });

    $('.fx-travel-net-amount').is(function(){
      var $el = $(this);
      netAmountState == "true" ? $el.show() : $el.hide();
    });

    $('.fx-travel-vat-amount').is(function(){
      var $el = $(this);
      vatAmountState == "true" ? $el.show() : $el.hide();
    });

  });

  $('.fx-select-travel-reason').on('change', function(e){
    e.preventDefault();

    var otherState = $(this).find(':selected').attr('data-other');
    var reasonState = $(this).find(':selected').val();

    // console.log(reasonState);

    $('.fx-travel-reason-other').is(function(){
      var $el = $(this);
      otherState == "true" ? $el.show() : $el.hide();
    });

    $('.fx-travel-court').is(function(){
      var $el = $(this);
      reasonState == "court_hearing" ? $el.show() : $el.hide();
    });

    $('.fx-travel-destination').is(function(){
      var $el = $(this);
      reasonState == "court_hearing" ? $el.hide() : $el.show();
    });

    // console.log($('#travel-expense-1-distance').val());

    // if (reasonState != 'court_hearing') {
    //   $('#travel-expense-1-distance').val('');
    // }

  });




  $('.fx-travel-court').on('change', function(e) {
    e.preventDefault();

    var origin = $('#origin_postcode').val();
    var destination = $(this).find(':selected').attr('data-postcode');

    // Travel modes: DRIVING (default), BICYCLING, TRANSIT, WALKING
    // Result container: container (default), textbox

    $('#travel-expense-1-distance').distancecalculator({
      start_address: origin,
      end_address: destination,
      units: 'mile',
      travel_mode: 'DRIVING',
      result_container_type: 'textbox'
    });


    if (typeof $('.travel-expense-1-cost-per-mile:checked').val() != 'undefined') {

      setTimeout(function () {

        // console.log($('.travel-expense-1-cost-per-mile:checked').val());

        var distance = $('#travel-expense-1-distance').val();

        // TODO get the selected option. If there is one selected, do the math
        var cost_per_mile = $('.travel-expense-1-cost-per-mile:checked').val();

        var net_amount = parseFloat(distance * cost_per_mile).toFixed(2);;
        var vat_amount = parseFloat(net_amount * 0.2).toFixed(2);

        $('#travel-expense-1-net-amount').val(net_amount);
        $('#travel-expense-1-vat-amount').val(vat_amount);

      }, 1000);

    }

    // setTimeout(function calcCost() {
    //   if ($('.travel-expense-1-cost-per-mile').val()) {
    //     var distance = $('#travel-expense-1-distance').val();

    //     var net_amount = parseFloat(distance * $('.travel-expense-1-cost-per-mile').val()).toFixed(2);;
    //     var vat_amount = parseFloat(net_amount * 0.2).toFixed(2);

    //     $('#travel-expense-1-net-amount').val(net_amount);
    //     $('#travel-expense-1-vat-amount').val(vat_amount);
    //   }
    // }, 500);

    // if ($('.travel-expense-1-cost-per-mile').val()) {
    //   $('.travel-expense-1-cost-per-mile').trigger('change');
    // }

  });

  $('.travel-expense-1-cost-per-mile').on('change', function(e){
    e.preventDefault();

    var $el = $(this);

    var distance = $('#travel-expense-1-distance').val();

    // TODO get the selected option. If there is one selected, do the math
    var cost_per_mile = $el.val();

    var net_amount = parseFloat(distance * cost_per_mile).toFixed(2);;
    var vat_amount = parseFloat(net_amount * 0.2).toFixed(2);

    $('#travel-expense-1-net-amount').val(net_amount);
    $('#travel-expense-1-vat-amount').val(vat_amount);

  });

  // $('#travel-expense-1-distance').on('input', function(e){
  //   e.preventDefault();

  //   var $el = $(this);

  //   var distance = $el.val();

  //   var net_amount = parseFloat(distance * $('.travel-expense-1-cost-per-mile').val()).toFixed(2);;
  //   var vat_amount = parseFloat(net_amount * 0.2).toFixed(2);

  //   $('#travel-expense-1-net-amount').val(net_amount);
  //   $('#travel-expense-1-vat-amount').val(vat_amount);

  // });

  if ($('.fx-select-expense-type').val()) {
    $('.fx-select-expense-type').trigger('change');
  }

  if ($('.fx-select-travel-reason').val()) {
    $('.fx-select-travel-reason').trigger('change');
  }

  if ($('.fx-select-court').val()) {
    $('.fx-select-court').trigger('change');
  }

});
</script>