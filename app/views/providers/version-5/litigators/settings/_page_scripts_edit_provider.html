<script type="text/javascript">
// $(document).ready(function(){

//   $(document).on('click', '.button-add-another', function (e) {
//     e.preventDefault();
//     var position = $(this).parents('#item-row');
//     insertFields(position);
//     sortFields();
//   });

//   $(document).on('click', '.remove-list-item', function (e) {
//     e.preventDefault();
//     $(this).parents('.list-item-wrapper').remove();
//     sortFields();
//   });

//   function insertFields(element) {
//     element.after(
//       '<div id="item-row" class="grid-row">' +
//         '<div class="list-item-wrapper">' +
//           '<h2 class="heading-small">Supplier 1</h2>' +
//           '<fieldset>' +
//             '<div class="column-one-half no-padding">' +
//               '<div class="form-group list-item">' +
//                 '<label class="form-label-bold" for="supplier-number-x">' +
//                   'Supplier number' +
//                   '<span class="form-hint">For example, 1A234B</span>' +
//                 '</label>' +
//                 '<input type="text" class="form-control form-control-2-3" id="supplier-number-x" name="supplier_number_x" value="{{data.supplier_number_x}}">' +
//               '</div>' +
//             '</div>' +
//             '<div class="column-one-half">' +
//               '<div class="list-item"></div>' +
//             '</div>' +
//           '</fieldset>' +
//           '<hr />' +
//         '</div>' +
//       '</div>'
//     );
//   }

//   function sortFields() {
//     var listCounter = 1;
//     var inputCounter = 1;
    
//     $(document).find('.list-item-wrapper').each(function () {
//       $(this).find('h2').text('Supplier ' + listCounter);

//       if ($(this).find('.remove-list-item').length === 0) {
//         $(this).find('.list-item:last').append('<a id="remove-item-' + listCounter + '" class="remove-list-item" href="#">Remove this</a>');
//       } else {
//         $(this).find('.remove-list-item').attr('id', 'remove-item-' + listCounter);
//       }

//       $(this).find('.list-item').children('label').each(function () {
//         $(this).attr('for', 'supplier-number-' + inputCounter);
//         inputCounter++;
//       });

//       $(this).find('.list-item').children('input').each(function () {
//         var num = $(this).parent().find('label').attr('for').split('-').pop();
//         $(this).attr('id', 'supplier-number-' + num);
//         $(this).attr('name', 'supplier_number_' + num);;
//       });

//       listCounter++;
//     });

//     if ($(document).find('.list-item-wrapper').length === 1) {
//       $('.remove-list-item').remove();
//     }
//   }

// });

$(document).ready(function(){

  $(document).on('click', '.button-add-another', function (e) {
    e.preventDefault();
    // console.log('add another');
    insertFields();
    sortFields();
  });

  $(document).on('click', '.remove-list-item', function (e) {
    e.preventDefault();
    $(this).parents('.list-item-row').remove();
    sortFields();
  });

  function insertFields() {
    // console.log('insert fields');
    $('.list-item-row:last').after(
      '<div class="grid-row list-item-row">' +
      '<div class="column-two-thirds">' +
      '<h2 class="heading-small list-item-heading">Supplier 1</h2>' +
      '<div class="form-group">' +
      '<label class="form-label-bold" for="supplier-number-x">' +
      'Supplier number' +
      '<span class="form-hint">For example, 1A234B</span>' +
      '</label>' +
      '<input type="text" class="form-control form-control-1-3" id="supplier-number-x" name="supplier_number_x" value="">' +
      '</div>' +
      // '<div class="form-group">' +
      // '<label class="form-label-bold" for="supplier-postcode-x">' +
      // 'Supplier postcode' +
      // '<span class="form-hint">For example, SW11 1AA</span>' +
      // '</label>' +
      // '<input type="text" class="form-control form-control-1-3" id="supplier-postcode-x" name="supplier_postcode_x" value="">' +
      // '</div>' +
      '<hr style="margin-bottom:30px;">' +
      '</div>' +
      '</div>'
    );
  }

  function sortFields() {
    // console.log('sort fields');
    var listCounter = 1;
    var inputCounter = 1;
    
    $(document).find('.list-item-row').each(function () {
      $(this).find('h2').text('Supplier ' + listCounter);

      if ($(this).find('.remove-list-item').length === 0) {
        $(this).find('.list-item-heading:last').append('<a id="remove-item-' + listCounter + '" class="link-remove remove-list-item" href="#">Remove <span class="visually-hidden">&nbsp;this supplier</span></a>');
      } else {
        $(this).find('.remove-list-item').attr('id', 'remove-item-' + listCounter);
      }

      $(this).find('.form-group').children('label').each(function () {
        $(this).attr('for', 'supplier-number-' + inputCounter);
        inputCounter++;
      });

      $(this).find('.form-group').children('input').each(function () {
        var num = $(this).parent().find('label').attr('for').split('-').pop();
        $(this).attr('id', 'supplier-number-' + num);
        $(this).attr('name', 'supplier_number_' + num);
      });

      listCounter++;
    });

    if ($(document).find('.list-item-row').length === 1) {
      $('.remove-list-item').remove();
    }
  }

});
</script>